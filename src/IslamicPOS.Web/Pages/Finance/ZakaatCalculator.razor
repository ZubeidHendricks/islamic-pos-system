@page "/finance/zakaat"
@using IslamicPOS.Application.Services
@inject ZakaatCalculationService ZakaatService

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">Zakaat Calculator</h3>
                </div>
                <div class="card-body">
                    <EditForm Model="@zakaatInput" OnValidSubmit="CalculateZakaat">
                        <div class="row g-3">
                            <!-- Cash and Bank Assets -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Cash on Hand</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.CashOnHand" />
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Bank Balance</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.BankBalance" />
                                </div>
                            </div>

                            <!-- Precious Metals -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Gold Value</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.GoldValue" />
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Silver Value</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.SilverValue" />
                                </div>
                            </div>

                            <!-- Business Assets -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Stock Value</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.StockValue" />
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Business Assets</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.BusinessAssets" />
                                </div>
                            </div>

                            <!-- Investments and Debts -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Investments</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.Investments" />
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Debts</label>
                                    <InputNumber class="form-control" @bind-Value="zakaatInput.Debts" />
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-success btn-lg">Calculate Zakaat</button>
                        </div>
                    </EditForm>

                    @if (calculationResult != null)
                    {
                        <div class="mt-4">
                            <div class="alert @(calculationResult.IsZakaatDue ? "alert-success" : "alert-info")">
                                <h4 class="alert-heading">Calculation Results</h4>
                                <hr>
                                <p class="mb-2">Total Wealth: @calculationResult.TotalWealth.ToString()</p>
                                <p class="mb-2">Nisab Threshold: @calculationResult.NisabThreshold.ToString()</p>
                                
                                @if (calculationResult.IsZakaatDue)
                                {
                                    <p class="mb-0"><strong>Zakaat Due: @calculationResult.ZakaatAmount.ToString()</strong></p>
                                }
                                else
                                {
                                    <p class="mb-0">Your wealth has not reached the Nisab threshold. No Zakaat is due at this time.</p>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private ZakaatInput zakaatInput = new();
    private ZakaatCalculation? calculationResult;

    private async Task CalculateZakaat()
    {
        calculationResult = await ZakaatService.CalculateZakaat(zakaatInput);
    }
}